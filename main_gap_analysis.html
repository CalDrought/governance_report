<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Gibbens-Matsuyama, Emma Bea Mitchell, Karol Paya, Takeen Shamloo">
<meta name="dcterms.date" content="2025-05-30">

<title>Main Gap Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main_gap_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_gap_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="main_gap_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="main_gap_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_gap_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_gap_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_gap_analysis_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_gap_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_gap_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_gap_analysis_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Gap Analysis</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#load-datasets" id="toc-load-datasets" class="nav-link" data-scroll-target="#load-datasets">Load Datasets</a></li>
  <li><a href="#within-datasets" id="toc-within-datasets" class="nav-link" data-scroll-target="#within-datasets">Within Datasets</a>
  <ul class="collapse">
  <li><a href="#actual-water-shortage-level" id="toc-actual-water-shortage-level" class="nav-link" data-scroll-target="#actual-water-shortage-level">Actual Water Shortage Level</a>
  <ul class="collapse">
  <li><a href="#issue-1-given-our-data-is-qualitative-and-was-most-recently-standardized" id="toc-issue-1-given-our-data-is-qualitative-and-was-most-recently-standardized" class="nav-link" data-scroll-target="#issue-1-given-our-data-is-qualitative-and-was-most-recently-standardized">Issue 1: Given our data is qualitative and was most recently standardized</a></li>
  <li><a href="#solution-1" id="toc-solution-1" class="nav-link" data-scroll-target="#solution-1">Solution 1</a></li>
  </ul></li>
  <li><a href="#five-year-water-shortage-outlook" id="toc-five-year-water-shortage-outlook" class="nav-link" data-scroll-target="#five-year-water-shortage-outlook">Five Year Water Shortage Outlook</a>
  <ul class="collapse">
  <li><a href="#issue-1-inconsistent-supplier-name-formatting" id="toc-issue-1-inconsistent-supplier-name-formatting" class="nav-link" data-scroll-target="#issue-1-inconsistent-supplier-name-formatting">Issue 1: Inconsistent Supplier Name Formatting</a></li>
  <li><a href="#solution-1-1" id="toc-solution-1-1" class="nav-link" data-scroll-target="#solution-1-1">Solution 1</a></li>
  </ul></li>
  <li><a href="#historical-production-and-delivery" id="toc-historical-production-and-delivery" class="nav-link" data-scroll-target="#historical-production-and-delivery">Historical Production and Delivery</a>
  <ul class="collapse">
  <li><a href="#issue-1-invalid-negative-numbers" id="toc-issue-1-invalid-negative-numbers" class="nav-link" data-scroll-target="#issue-1-invalid-negative-numbers">Issue 1: Invalid Negative numbers</a></li>
  <li><a href="#solution-1-2" id="toc-solution-1-2" class="nav-link" data-scroll-target="#solution-1-2">Solution 1</a></li>
  <li><a href="#issue-2-date-limit" id="toc-issue-2-date-limit" class="nav-link" data-scroll-target="#issue-2-date-limit">Issue 2: Date limit</a></li>
  <li><a href="#solution-2" id="toc-solution-2" class="nav-link" data-scroll-target="#solution-2">Solution 2</a></li>
  <li><a href="#issue-3-total-water-supply-is-less-than-to-the-total-water-produced" id="toc-issue-3-total-water-supply-is-less-than-to-the-total-water-produced" class="nav-link" data-scroll-target="#issue-3-total-water-supply-is-less-than-to-the-total-water-produced">Issue 3: total water supply is less than to the total water produced</a></li>
  <li><a href="#solution-3" id="toc-solution-3" class="nav-link" data-scroll-target="#solution-3">Solution 3:</a></li>
  </ul></li>
  <li><a href="#monthly-water-shortage-outlook" id="toc-monthly-water-shortage-outlook" class="nav-link" data-scroll-target="#monthly-water-shortage-outlook">Monthly Water Shortage Outlook</a>
  <ul class="collapse">
  <li><a href="#issue-2-column-descriptions" id="toc-issue-2-column-descriptions" class="nav-link" data-scroll-target="#issue-2-column-descriptions">Issue 2: Column descriptions</a></li>
  <li><a href="#solution-2-1" id="toc-solution-2-1" class="nav-link" data-scroll-target="#solution-2-1">Solution 2</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#gaps-across-datasets" id="toc-gaps-across-datasets" class="nav-link" data-scroll-target="#gaps-across-datasets">Gaps Across Datasets</a>
  <ul class="collapse">
  <li><a href="#issue-1-large-amount-of-missing-values" id="toc-issue-1-large-amount-of-missing-values" class="nav-link" data-scroll-target="#issue-1-large-amount-of-missing-values">Issue 1: Large amount of missing values</a></li>
  <li><a href="#issue-2-little-to-no-overlap-between-dates-in-datasets" id="toc-issue-2-little-to-no-overlap-between-dates-in-datasets" class="nav-link" data-scroll-target="#issue-2-little-to-no-overlap-between-dates-in-datasets">Issue 2: Little to no overlap between dates in datasets</a></li>
  <li><a href="#issue-3-total-water-use-is-less-to-the-total-water-supply" id="toc-issue-3-total-water-use-is-less-to-the-total-water-supply" class="nav-link" data-scroll-target="#issue-3-total-water-use-is-less-to-the-total-water-supply">Issue 3: total water use is less to the total water supply</a></li>
  <li><a href="#issue-4-not-applicable-vs.-missing-values" id="toc-issue-4-not-applicable-vs.-missing-values" class="nav-link" data-scroll-target="#issue-4-not-applicable-vs.-missing-values">Issue 4: Not applicable Vs. missing values</a></li>
  <li><a href="#issue-5-standardize-naming" id="toc-issue-5-standardize-naming" class="nav-link" data-scroll-target="#issue-5-standardize-naming">Issue 5: Standardize Naming</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Main Gap Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tom Gibbens-Matsuyama, Emma Bea Mitchell, Karol Paya, Takeen Shamloo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document presents the results of a gap analysis of urban water data available on the <a href="https://data.cnra.ca.gov/dataset/urban-water-data-drought">California Natural Resource Agency‚Äôs website</a>. The California Water Data Consortium, in partnership with the Department of Water Resources (DWR) and the State Water Resources and Control Board aim to improve urban water supplier data‚Äôs accessibility and usability. In conjunction with UCSB‚Äôs Bren School‚Äôs Master of Environmental Data Science CalDrought Capstone Team, we aim to provide an assessment of the following data, providing a contextualized breakdown as well as written code for checking said breakdown. The report is organized into two main sections: Within Datasets and Across Datasets.<br>
<br>
The <strong>Within Datasets</strong> section focuses on internal inconsistencies or missing information found <em>within each individual dataset</em>. This includes issues such as incomplete fields, inconsistent formatting, unexpected data values, or gaps in time series data that reduce the reliability or interpretability of a single dataset on its own.</p>
<p>The <strong>Across Datasets</strong> section examines cross-referenced issues between the datasets. These inconsistencies can pose challenges for users attempting to combine or compare data across sources for comprehensive analysis or decision-making.</p>
<p>Together, these two levels of analysis aim to provide a detailed understanding of where data quality and compatibility issues exist. These sections highlight data gaps found in the four primary datasets used in this project:</p>
<ul>
<li><p>Actual Water Shortage Level</p></li>
<li><p>Five-Year Water Shortage Outlook</p></li>
<li><p>Historical Production and Delivery</p></li>
<li><p>Monthly Water Shortage Outlook</p></li>
</ul>
</section>
<section id="load-datasets" class="level1">
<h1>Load Datasets</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>actual_water_shortage_level <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"actual_water_shortage_level.csv"</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>five_year_shortage <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"five_year_water_shortage_outlook.csv"</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>historical_production_delivery <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"historical_production_delivery.csv"</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>monthly_water_shortage_outlook <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"monthly_water_shortage_outlook.csv"</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>source_name <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"source_name.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="within-datasets" class="level1">
<h1>Within Datasets</h1>
<p>This section identifies and evaluates discrepancies, inconsistencies, or missing elements within each of the four urban water datasets: Actual Water Shortage Level, Five Year Water Shortage Outlook, Historical Production and Delivery, and Monthly Water Shortage Outlook. For each dataset, the identified gap is highlighted and a targeted solutions is proposed to enhance data quality, standardization, and interpretability.</p>
<section id="actual-water-shortage-level" class="level2">
<h2 class="anchored" data-anchor-id="actual-water-shortage-level">Actual Water Shortage Level</h2>
<p>This dataset reports the monthly state standard shortage level by urban retail water suppliers, which are generally defined as agencies serving over 3,000 service connections or deliveries 3,000 acre-feet of water annually for municipal purposes. These data are collected by the State Water Resources Control Board through its monthly Conservation Reporting and the data included in this dataset represent a small component of the larger dataset. Information about these reports can be found on the Water Conservation Portal, which is no longer active, and the full data (which represents the source data for this dataset) are available on the California Open Data Portal. Beginning in 2023, the reporting of these data transitioned to the SAFER Clearinghouse.</p>
<p>Data use limitations: Prior to 2022, shortage levels were not standardized, which makes the data difficult to use. This dataset was filtered to include 2022 onwards where shortage levels are standardized.</p>
<section id="issue-1-given-our-data-is-qualitative-and-was-most-recently-standardized" class="level3">
<h3 class="anchored" data-anchor-id="issue-1-given-our-data-is-qualitative-and-was-most-recently-standardized">Issue 1: Given our data is qualitative and was most recently standardized</h3>
<p>Although standardized reporting for the <em>state standard shortage level</em> began on January 1, 2022, the data reveal that the first two months of reporting (January and February 2022) contain <code>NA</code> values across all reporting agencies. This raises uncertainty about whether these gaps are due to non-submission by the agencies or due to legacy data not being translatable into the new standard. Because of the qualitative nature of this field and the timing of the standardization, it is difficult to confidently interpret early 2022 data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count of NA's by start_date.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>actual_water_shortage_level <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_date) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na_count =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(state_standard_shortage_level)),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_orgs =</span> <span class="fu">n_distinct</span>(org_id)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 3
  start_date na_count unique_orgs
  &lt;date&gt;        &lt;int&gt;       &lt;int&gt;
1 2022-01-01      400         400
2 2022-02-01      393         393</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check unique values (excluding numeric codes)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>actual_water_shortage_level <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(state_standard_shortage_level)) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(state_standard_shortage_level)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 1
  state_standard_shortage_level
                          &lt;dbl&gt;
1                             2
2                             0
3                             1
4                             3
5                             4
6                             5</code></pre>
</div>
</div>
</section>
<section id="solution-1" class="level3">
<h3 class="anchored" data-anchor-id="solution-1">Solution 1</h3>
<p>To improve data usability moving forward, we recommend maintaining strict adherence to the standardized shortage level categories introduced in 2022. In addition, metadata should accompany future records to indicate whether <code>NA</code> values represent missing submissions or untranslatable entries. This distinction will improve transparency and enable better filtering or imputation strategies in downstream analysis. For historic data, a one-time reconciliation process could help align early 2022 records with the new schema where feasible, or clearly flag them as transitional placeholders. We also recommend flagging records from January and February 2022 in any public dashboards or visualizations to prevent misinterpretation.</p>
</section>
</section>
<section id="five-year-water-shortage-outlook" class="level2">
<h2 class="anchored" data-anchor-id="five-year-water-shortage-outlook">Five Year Water Shortage Outlook</h2>
<p>This table provides anticipated annual potable water levels (both surplus and shortage) with shortage actions and without shortage actions for five years based on the five driest consecutive years on record. The Urban Water Management Plans (UWMP) reports this data. All data reported through the UWMP are currently available on the WUE portal and the California Natural Resources Open Data Portal. The most recent UWMP guidance is available here. See 7-20 through 7-34 for information about the data elements contained in the five_year_outlook table.</p>
<p>The most important metrics for this dataframe are as follows: <code>water_use_acre_feet</code>, <code>water_supplies_acre_feet</code>, <code>benefit_supply_augmentation_acre_feet</code>, and <code>benefit_demand_reduction_acre_feet</code>. These variables represent, for a given year, total water use, total water supply, total supply augmentation (buying from another water district), and total demand reduction (policies in place to reduce water use) for specific water districts. As explained above, this dataset has self reported metrics from each local water district based on their five driest consecutive years on record.</p>
<p>Data use limitations: Similar to the monthly_water_shortage_outlook data, these data also reflect forecasted values rather than actual values. These data are expected to change as conditions change.</p>
<section id="issue-1-inconsistent-supplier-name-formatting" class="level3">
<h3 class="anchored" data-anchor-id="issue-1-inconsistent-supplier-name-formatting">Issue 1: Inconsistent Supplier Name Formatting</h3>
<p>While this issue does not affect the integrity of the data itself, the formatting of values in the <code>supplier_name</code> column is inconsistent and unstandardized. These inconsistencies‚Äîsuch as variations in the placement of phrases like ‚ÄúCity of‚Äù and inconsistent capitalization‚Äîcomplicate data visualization, grouping, and table presentation. Minor pre-processing is required to standardize naming conventions for accurate and aesthetically consistent outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename city names</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>five_year_shortage_name <span class="ot">&lt;-</span> five_year_shortage <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change position of city of to be behind the city name</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ([a-zA-Z\\]+) selects any sequence before city of</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># City of \\1 rearranges text so "city of" comes first</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">supplier_name =</span> <span class="fu">str_replace</span>(supplier_name, <span class="st">"([a-zA-Z</span><span class="sc">\\</span><span class="st">s]+) city of"</span>, <span class="st">"city of </span><span class="sc">\\</span><span class="st">1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">supplier_name =</span> <span class="fu">str_to_title</span>(supplier_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Data Check 1</strong> The following is a method to check that each unique water district has 5 represented drought years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if each water district has five drought years</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>five_year_data_check <span class="ot">&lt;-</span> five_year_shortage <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by each org ID</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(org_id) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count each org IDs observations </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"Each org_id should have exactly 5 observations"</span>, {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if any org_id does not have exactly 5 observations</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">all</span>(five_year_data_check<span class="sc">$</span>n <span class="sc">==</span><span class="dv">5</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">info =</span> <span class="st">"One or more org_ids do not have exactly 5 observations"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed üéä</code></pre>
</div>
</div>
</section>
<section id="solution-1-1" class="level3">
<h3 class="anchored" data-anchor-id="solution-1-1">Solution 1</h3>
<p>To address inconsistencies in the <code>supplier_name</code> field, we recommend standardizing the naming conventions for water suppliers across all data submissions and outputs. As a short-term solution, string manipulation‚Äîsuch as repositioning ‚ÄúCity of‚Äù prefixes and converting names to title case‚Äîcan be applied during preprocessing to improve readability and usability in plots and tables. However, for a more robust long-term solution, the use of unique identifiers (such as <code>org_id</code>) should be prioritized in analysis, with <code>supplier_name</code> treated as a display label only. We also recommend that the data providers issue guidance or validation checks during UWMP submissions to enforce a consistent naming schema across years and districts. This will reduce post-processing overhead and increase the comparability of results across datasets.</p>
<p>Regarding the data check on drought year representation, we suggest including an automated validation step in the preprocessing pipeline that flags any <code>org_id</code> not reporting exactly five observations. These flags can be reviewed to determine whether the omissions are due to non-reporting, data entry errors, or justified exceptions (e.g., newly formed districts or incomplete UWMPs). Adding these QA steps ensures completeness and supports downstream reliability in long-term drought planning analyses.</p>
</section>
</section>
<section id="historical-production-and-delivery" class="level2">
<h2 class="anchored" data-anchor-id="historical-production-and-delivery">Historical Production and Delivery</h2>
<p>The Historical Production and Delivery dataframe provides data about water production and delivery from 2013-2022. The columns are PWSID, water system name, org id, start date, end date, water produced or delivered, water type, and quantity acre feet. It should be noted that the water type column contains both produced water types and delivered water types. The first step when working with the data for analysis should be to filter the water produced or delivered column for either produced or delivered. This will then allow for ease of analysis.</p>
<section id="issue-1-invalid-negative-numbers" class="level3">
<h3 class="anchored" data-anchor-id="issue-1-invalid-negative-numbers">Issue 1: Invalid Negative numbers</h3>
<p>The <code>quantity_acre_feet</code> column includes 280 negative values, which are not physically meaningful in the context of water volume reporting. Water quantity, whether produced or delivered, cannot logically be negative. These values may result from data entry errors, reverse flow misreporting, or incorrect unit handling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count negative values</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>historical_production_delivery <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(quantity_acre_feet <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 280</code></pre>
</div>
</div>
</section>
<section id="solution-1-2" class="level3">
<h3 class="anchored" data-anchor-id="solution-1-2">Solution 1</h3>
<p>Although 280 is a very small number in comparison to the 902 thousand rows present in the table, it‚Äôs still best practice to remove them when calculating summary statistics. To address this issue, we recommend to apply a data validation rule that flags and excludes negative <code>quantity_acre_feet</code> values during preprocessing. These records should be reviewed to determine whether the negative value reflects a known reporting convention (e.g., returns, corrections, or cancellations) or is simply erroneous. Second, when appropriate, If the absolute values are not correct, replacing them with NAs or the correct value is necessary. These entries could be corrected by either referencing historical averages for the same water district and period or through communication with the data provider to clarify reporting intent.</p>
</section>
<section id="issue-2-date-limit" class="level3">
<h3 class="anchored" data-anchor-id="issue-2-date-limit">Issue 2: Date limit</h3>
<p>Dataset is currently not up to date (as of April 2025).</p>
</section>
<section id="solution-2" class="level3">
<h3 class="anchored" data-anchor-id="solution-2">Solution 2</h3>
<p>While the metadata does explain the lack of entries for recent years, in the future, years will continue to be updated to allow for meaningful analysis.</p>
</section>
<section id="issue-3-total-water-supply-is-less-than-to-the-total-water-produced" class="level3">
<h3 class="anchored" data-anchor-id="issue-3-total-water-supply-is-less-than-to-the-total-water-produced">Issue 3: total water supply is less than to the total water produced</h3>
<p>A number of records show cases where the reported total water supply is less than the total water produced, even though the supply figures are expected to include both locally produced water and purchased/imported water. This inconsistency suggests potential reporting inaccuracies or misinterpretation of what constitutes ‚Äútotal supply‚Äù versus ‚Äúproduced water.‚Äù Since purchased water is a component of total supply, it is illogical for supply values to be lower than production values unless specific operational losses are accounted for, which is not documented in this dataset. Such discrepancies may result from inconsistent self-reporting by water districts or from misunderstandings in how variables should be calculated or classified.</p>
</section>
<section id="solution-3" class="level3">
<h3 class="anchored" data-anchor-id="solution-3">Solution 3:</h3>
<p>To resolve this issue, we recommend strengthening guidance and training for urban water suppliers during the self-reporting process. For a Long term solution, creating a user-friendly data entry interface with built-in validation logic and tooltips can help prevent reporting errors and improve consistency across suppliers.</p>
</section>
</section>
<section id="monthly-water-shortage-outlook" class="level2">
<h2 class="anchored" data-anchor-id="monthly-water-shortage-outlook">Monthly Water Shortage Outlook</h2>
<p>Forecasted Monthly Water Shortage (Level/percentage/quantity)</p>
<p>The California Water Code requires each urban water supplier to provide a description of the data used to characterize and quantify the water use types and water demands in their UWMP. This dataset was created to provide forecasted monthly (and annual) potable water shortage (or surplus) with and without shortage actions for a dry year. The Annual Water Supply and Demand Assessment (AWSDA) reports this data. All data reported through the AWSDA are available on the DWR‚Äôs Water Use Efficiency (WUE) portal<br>
<br>
Suppliers report the numbers of their estimated total annual demands based on their planning cycle (from July ‚Äì June Planning Cycle: Suppliers with a current planning cycle starting on the July due date and ending on the following June)</p>
<section id="issue-2-column-descriptions" class="level3">
<h3 class="anchored" data-anchor-id="issue-2-column-descriptions">Issue 2: Column descriptions</h3>
</section>
<section id="solution-2-1" class="level3">
<h3 class="anchored" data-anchor-id="solution-2-1">Solution 2</h3>
<p>Consider including a data dictionary for external users‚Äîsome field names are intuitive (<code>shortage_surplus_percent</code>), others less so (<code>is_wscp_action</code>).</p>
</section>
</section>
</section>
<section id="gaps-across-datasets" class="level1">
<h1>Gaps Across Datasets</h1>
<p>In addition to dataset-specific issues, this section examines discrepancies and limitations that affect the integration of information across all four urban water datasets. These issues include inconsistent organization identifiers, variable naming conventions, different resolutions, and inconsistent geographic references across datasets. These inconsistencies makes it hard to combine or compare data across different water districts or time. This section also offers recommendations aimed at improving alignment across datasets.</p>
<section id="issue-1-large-amount-of-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="issue-1-large-amount-of-missing-values">Issue 1: Large amount of missing values</h3>
<p>In order to work with these datasests and prevent misinformation, missing values will be removed and/or replaced in this dataset. Below are some examples of large missing information:<br>
<br>
Actual Shortage: From our data we can also perceive that even past the adoption date beginning 2022 we do have a large amount of ‚Äònot available‚Äô (NA) values within our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count of NA's by start_date.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>actual_water_shortage_level <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_date) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na_count =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(state_standard_shortage_level)),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_orgs =</span> <span class="fu">n_distinct</span>(org_id)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 √ó 3
   start_date na_count unique_orgs
   &lt;date&gt;        &lt;int&gt;       &lt;int&gt;
 1 2022-03-01        1         401
 2 2022-04-01        3         401
 3 2022-05-01        5         400
 4 2022-06-01        4         402
 5 2022-07-01        3         397
 6 2022-08-01        3         399
 7 2022-09-01        1         398
 8 2022-10-01        3         391
 9 2022-11-01        4         388
10 2022-12-01        4         392
# ‚Ñπ 19 more rows</code></pre>
</div>
</div>
<p>Historical Production and Delivery: The first issue is the amount of N/As in the dataset. This prevents the data from being easy to interpret and could lead to misinformation. There are currently 111,414 NAs in this data alone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check amount of NAs for entire dataset</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 111414</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check amount of NAs for individual columns</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>pwsid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>water_system_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>org_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>start_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>end_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>water_produced_or_delivered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>water_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># currently all NAs located in quantity acre feet column</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(historical_production_delivery<span class="sc">$</span>quantity_acre_feet))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 111414</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove NAs from dataset</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>historical_production_delivery <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(historical_production_delivery)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Five Year Shortage: When viewing the dataframe, one of the first things one may notice is that there are a lot of missing values for the <code>benefit_supply_augmentation_acre_feet</code> and <code>benefit_demand_reduction_acre_feet</code> columns. That being said, if <code>water_use_acre_feet</code> is less than or equal to <code>water_supplies_acre_feet</code> then it is not necessary to reduce or augment water, meaning the people who self reported this data did not enter anything for the columns, resulting in an <code>NA</code> value. However, let‚Äôs check to see if there are any data discrepancies where this does not hold true: where values for <code>supply_augmentation</code> and <code>demand_reduction</code> should be present, but are not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter five year data </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>five_use_greater_supply <span class="ot">&lt;-</span> five_year_shortage <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to where Use is greater than Supply</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(water_use_acre_feet <span class="sc">&gt;</span> water_supplies_acre_feet,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Now filter for NAs in both augmentation &amp; reduction columns</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">is.na</span>(benefit_supply_augmentation_acre_feet) <span class="sc">&amp;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(benefit_demand_reduction_acre_feet))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This filtered dataframe shows some discrepancies within the original data. The new dataframe is very small (12 observations), which is a good thing.</p>
<p><strong>Solution</strong></p>
<p>There are no real data science solutions to fix this. As this is self reported data, the solution should be fixated on the source (specific water district). Also, is it recommended to provide a more detailed metadata, that could explain why there are so many NAs and what they mean.</p>
</section>
<section id="issue-2-little-to-no-overlap-between-dates-in-datasets" class="level3">
<h3 class="anchored" data-anchor-id="issue-2-little-to-no-overlap-between-dates-in-datasets">Issue 2: Little to no overlap between dates in datasets</h3>
<p>An example is the actual shortage data, which is limited to only WY 2022, 2023, and half of 2024. It is limited with 31 months worth of data starting Jan 01, 2022 - July 31, 2024.</p>
<p><strong>Start Dates</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique start_date values</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>all_start_dates <span class="ot">&lt;-</span> actual_water_shortage_level <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(start_date) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(start_date)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_start_dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 √ó 1
   start_date
   &lt;date&gt;    
 1 2022-01-01
 2 2022-02-01
 3 2022-03-01
 4 2022-04-01
 5 2022-05-01
 6 2022-06-01
 7 2022-07-01
 8 2022-08-01
 9 2022-09-01
10 2022-10-01
# ‚Ñπ 21 more rows</code></pre>
</div>
</div>
<p><strong>End Dates</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique end_date values</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>all_end_dates <span class="ot">&lt;-</span> actual_water_shortage_level <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(end_date) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(end_date)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_end_dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 √ó 1
   end_date  
   &lt;date&gt;    
 1 2022-01-31
 2 2022-02-28
 3 2022-03-31
 4 2022-04-30
 5 2022-05-31
 6 2022-06-30
 7 2022-07-31
 8 2022-08-31
 9 2022-09-30
10 2022-10-31
# ‚Ñπ 21 more rows</code></pre>
</div>
</div>
<p>There are 31 observations and 31 months between the first/last start and end dates.</p>
<p>First Start_date: 01/01/2022, Last Start_date: 07/01/2024</p>
<p>First End_date: 01/31/2022, Last End_date: 07/31/2024</p>
<p><strong>Solution</strong></p>
<p>Future consistent additions to the dataset over time will create overlap that can then be used for comparison and analysis.</p>
</section>
<section id="issue-3-total-water-use-is-less-to-the-total-water-supply" class="level3">
<h3 class="anchored" data-anchor-id="issue-3-total-water-use-is-less-to-the-total-water-supply">Issue 3: total water use is less to the total water supply</h3>
<p>As mentioned above, there are four metrics that we are interested in for this dataset. These four variables combined make up how much water a water district has available and is using. In many such cases the total water use is less than or equal to the total water supply. This indicates that a water district has a surplus of water. However, in the other case, where total water use is greater than total water supply, it must mean that the water district is either augmenting their water supply or reducing their water consumption. Thus, total water use should equal total water supply + total benefit augmentation + total demand reduction.</p>
<p>To find the rows where this doesn‚Äôt hold true, let‚Äôs assume that <code>NA</code> values for <code>supply_augmentation</code> and <code>demand_reduction</code> are 0s. Let‚Äôs use this logic to find water districts that have misreported data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with 0s, assuming this as true </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>five_year_replace_na <span class="ot">&lt;-</span> five_year_shortage <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mutate existing columns and replace NAs with 0s</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">benefit_supply_augmentation_acre_feet =</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_na</span>(benefit_supply_augmentation_acre_feet, <span class="dv">0</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">benefit_demand_reduction_acre_feet =</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace_na</span>(benefit_demand_reduction_acre_feet, <span class="dv">0</span>)) </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function that calculates supply + demand red + supply aug when Use &gt; Supply</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>calculate_benefit <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  five_year_replace_na <span class="sc">%&gt;%</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new columns</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total_benefit =</span> <span class="fu">ifelse</span>(</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use ifelse statement for when use &gt; supply </span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>      water_use_acre_feet <span class="sc">&gt;</span> water_supplies_acre_feet,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If true, then do the following, If false, assign a 0 </span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>      water_supplies_acre_feet <span class="sc">+</span> benefit_demand_reduction_acre_feet <span class="sc">+</span> benefit_supply_augmentation_acre_feet, <span class="dv">0</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the function to reassign the df </span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>five_year_replace_na <span class="ot">&lt;-</span> <span class="fu">calculate_benefit</span>(five_year_replace_na)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data where total_benefit does not equal total use</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>five_year_na_filtered <span class="ot">&lt;-</span> five_year_replace_na <span class="sc">%&gt;%</span> </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_benefit <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>         water_use_acre_feet <span class="sc">!=</span> total_benefit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Solution</strong></p>
<p>From this output, we can see the local water districts that have areas of error. Similar to the first issue, there are no proper data science solutions to fix this problem, as it stems for the initial self-reporting from water districts.</p>
</section>
<section id="issue-4-not-applicable-vs.-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="issue-4-not-applicable-vs.-missing-values">Issue 4: Not applicable Vs. missing values</h3>
<p>Lack of clear distinction between N/As, meaning that there is no distinction between non-applicable values and missing information.</p>
<p><strong>Solution</strong></p>
<p>Have detailed metadata explaining the difference and how to identify that. If the difference is not identifiable, that should also be clear in the metadata.</p>
</section>
<section id="issue-5-standardize-naming" class="level3">
<h3 class="anchored" data-anchor-id="issue-5-standardize-naming">Issue 5: Standardize Naming</h3>
<p><code>supplier_name</code> could be normalized or matched against a unique registry to reduce duplicates or misspellings.</p>
<p><strong>Solution</strong></p>
<p>Add to the reporting form the list of water districts where user can select from.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>